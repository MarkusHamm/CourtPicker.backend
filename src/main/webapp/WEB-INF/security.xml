<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-3.0.xsd">



<bean id="authenticationManager" class="org.acegisecurity.providers.ProviderManager">
	<property name="providers">
			<ref bean="authenticationProvider"/>
	</property>
</bean>

<bean id="authenticationProvider" class="org.acegisecurity.providers.dao.DaoAuthenticationProvider">
	<property name="userDetailsService">
		<ref bean="authenticationDao"/>
	</property>
	<property name="passwordEncoder">
		<bean class="org.acegisecurity.providers.encoding.Md5PasswordEncoder" />
	</property>
	<property name="saltSource">
		<bean class="org.acegisecurity.providers.dao.salt.SystemWideSaltSource">
			<property name="systemWideSalt" value="ABC1234MH1980" />
		</bean>
	</property>
</bean>

<bean id="authenticationDao" class="org.acegisecurity.userdetails.jdbc.JdbcDaoImpl">
	<property name="dataSource" ref="dataSource"/>
	<property name="usersByUsernameQuery">
		<value>
		SELECT "Username" as username, "Password" as password, "Enabled" from roger."Customer" where "Username"=?
		</value>
	</property>
		<property name="authoritiesByUsernameQuery">
		<value>
			SELECT "c"."Username" as username, "a"."authority" from roger."Customer" "c", roger."Authorities" "a" where "c"."Username"="a"."Customer_Username" AND "c"."Username"=?
<!--		SELECT c.Username as username, a.authority from Customer c, Authorities a where c.Username=a.Customer_Username AND c.Username=?-->
		</value>
	</property>
</bean>

<bean id="accessDecisionManager" class="org.acegisecurity.vote.UnanimousBased">
	<property name="decisionVoters">
		<list>
		<ref bean="roleVoter" />
	</list>
	</property>
	<property name="allowIfAllAbstainDecisions">
			<value>true</value>
		</property>

</bean>

<bean id="roleVoter" class="org.acegisecurity.vote.RoleVoter">
	<property name="rolePrefix" value="ROLE_" />
</bean>

<!--Spring Security-->
<bean id="filterChainProxy" class="org.acegisecurity.util.FilterChainProxy">
	<property name="filterInvocationDefinitionSource">
		<value>
		CONVERT_URL_TO_LOWERCASE_BEFORE_COMPARISON
		PATTERN_TYPE_APACHE_ANT
		/js/*=#NONE#
		/css/*=#NONE#
		/**=httpSessionIntegrationFilter, authenticationProcessingFilter, exceptionTranslationFilter, filterSecurityInterceptor
		</value>
	</property>
</bean>

<bean id="httpSessionIntegrationFilter" class="org.acegisecurity.context.HttpSessionContextIntegrationFilter"/>

<bean id="authenticationEntryPoint" class="org.acegisecurity.ui.webapp.AuthenticationProcessingFilterEntryPoint">
	<property name="loginFormUrl" value="/addReservation.htm"/>
	<property name="forceHttps" value="true" />
</bean>

<bean id="authenticationProcessingFilter" class="org.acegisecurity.ui.webapp.AuthenticationProcessingFilter">
	<property name="filterProcessesUrl" value="/j_acegi_security_check" />
	<property name="authenticationFailureUrl" value="/addReservation.htm?login_error=1" />
	<property name="defaultTargetUrl" value="/addReservation.htm" />
	<property name="authenticationManager" ref="authenticationManager" />
</bean>


<bean id="exceptionTranslationFilter" class="org.acegisecurity.ui.ExceptionTranslationFilter">
	<property name="authenticationEntryPoint" ref="authenticationEntryPoint" />
	<property name="accessDeniedHandler" ref="accessDeniedHandler" />
</bean>

<bean id="accessDeniedHandler" class="org.acegisecurity.ui.AccessDeniedHandlerImpl">
	<property name="errorPage" value="/error.htm" />
</bean>

<bean id="filterSecurityInterceptor" class="org.acegisecurity.intercept.web.FilterSecurityInterceptor">
	<property name="authenticationManager" ref="authenticationManager" />
	<property name="accessDecisionManager" ref="accessDecisionManager" />
	<property name="objectDefinitionSource" >
		<value>
		CONVERT_URL_TO_LOWERCASE_BEFORE_COMPARISON
		PATTERN_TYPE_APACHE_ANT
		/confirmreservation.htm=ROLE_CUSTOMER
		/customer.htm=ROLE_CUSTOMER
		</value>
	</property>
</bean>

<bean id="channelProcessingFilter" class="org.acegisecurity.securechannel.ChannelProcessingFilter">
	<property name="filterInvocationDefinitionSource">
		<value>
			CONVERT_URL_TO_LOWERCASE_BEFORE_COMPARISON
			PATTERN_TYPE_APACHE_ANT
			/addreservation.htm=REQUIRES_SECURE_CHANNEL
			/j_acegi_security_check*=REQUIRES_SECURE_CHANNEL
			/**=REQUIRES_INSECURE_CHANNEL
		</value>
	</property>
	<property name="channelDecisionManager" ref="channelDecisionManager" />
</bean>

<bean id="channelDecisionManager" class="org.acegisecurity.securechannel.ChannelDecisionManagerImpl" >
	<property name="channelProcessors">
		<list>
			<bean class="org.acegisecurity.securechannel.SecureChannelProcessor" />
			<bean class="org.acegisecurity.securechannel.InsecureChannelProcessor" />
		</list>
	</property>
</bean>




</beans>
